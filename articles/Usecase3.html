<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use Case 03: Estimation of intracluster correlations (ICC) by cluster size â€¢ CRTspat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Case 03: Estimation of intracluster correlations (ICC) by cluster size">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Usecase1.html">Use Case 01: Algorithmic specification of clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase2.html">Use Case 02: Simulation of trials with geographical spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase3.html">Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase4.html">Use Case 04: Estimation of optimal cluster size for a trial with pre-determined buffer width</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase5.html">Use Case 05: Analysis of trials (including methods for analysing spillover)</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase6.html">Use Case 06: Thematic mapping of the geography of a CRT</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase7.html">Use Case 07: Power and sample size calculations allowing for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase8.html">Use Case 08: Eggs - to fry or scramble?</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase9.html">Use Case 09: Preparation of datasets for `CRTspat`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</h1>
            
      

      <div class="d-none name"><code>Usecase3.Rmd</code></div>
    </div>

    
    
<p>The Intracluster Correlation Coefficient (ICC) is one of the inputs
to standard power and sample size calculations for CRTs. Trialists often
have difficulty identifying an appropriate source for their ICC
calculations, or use a value from a source of questionable
relevance.</p>
<p>The <a href="../reference/CRTanalysis.html"><code>CRTanalysis</code></a>
function has an option to use Generalised Estimating Equations, which
provide an estimate of the ICC. This can be applied to baseline data,
and hence to different cluster configurations. This makes it possible to
estimate the ICC which is appropriate for any given cluster definition,
in the chosen geography, assuming baseline data are available.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use the same dataset as for Use Case 1.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CRTspat</span><span class="op">)</span></span>
<span><span class="va">example_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">'example_site.csv'</span><span class="op">)</span></span>
<span><span class="va">example_locations</span><span class="op">$</span><span class="va">base_denom</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">example_locations</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/aggregateCRT.html">aggregateCRT</a></span><span class="op">(</span>auxiliaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RDT_test_result"</span>, <span class="st">"base_denom"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##         Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x -3.20    -1.40    -0.30    -0.07     1.26     5.16   </span></span>
<span><span class="co">##       y -5.08    -2.84     0.19     0.05     2.49     6.16   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  27.6 sq.km</span></span>
<span><span class="co">## Total area (convex hull) :  48.2 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          -                        </span></span>
<span><span class="co">## Coordinate system                      (x, y)                        </span></span>
<span><span class="co">## Locations:                                                      1181                        </span></span>
<span><span class="co">## Available clusters (across both arms)                           Not assigned                        </span></span>
<span><span class="co">## No randomization          -                        </span></span>
<span><span class="co">## No power calculations to report          -                        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Other variables in dataset</span></span>
<span><span class="co">## --------------------------          RDT_test_result  base_denom</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># randomly sample an array of values of c (use a small sample size for testing</span></span>
<span><span class="co"># the plots were produced with n=5000)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">c_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50</span>, min <span class="op">=</span> <span class="fl">6</span>, max <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a user function randomizes and analyses each simulated trial</span></span>
<span><span class="va">CRTscenario3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">c</span>, <span class="va">CRT</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span><span class="va">CRT</span>, c <span class="op">=</span> <span class="va">c</span>, algo <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="va">GEEanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">ex</span>, method <span class="op">=</span> <span class="st">"GEE"</span>, baselineOnly <span class="op">=</span> <span class="cn">TRUE</span>, excludeBuffer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          baselineNumerator <span class="op">=</span> <span class="st">"RDT_test_result"</span>, baselineDenominator <span class="op">=</span> <span class="st">"base_denom"</span><span class="op">)</span></span>
<span>    <span class="va">locations</span> <span class="op">&lt;-</span> <span class="va">GEEanalysis</span><span class="op">$</span><span class="va">description</span><span class="op">$</span><span class="va">locations</span></span>
<span>    <span class="va">ICC</span> <span class="op">&lt;-</span> <span class="va">GEEanalysis</span><span class="op">$</span><span class="va">description</span><span class="op">$</span><span class="va">ICC</span></span>
<span>    <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>c <span class="op">=</span> <span class="va">c</span>, ICC <span class="op">=</span> <span class="va">ICC</span>, mean_h <span class="op">=</span> <span class="va">locations</span><span class="op">/</span><span class="va">c</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># The results are collected in a data frame</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">c_vec</span>, FUN <span class="op">=</span> <span class="va">CRTscenario3</span>, simplify <span class="op">=</span> <span class="st">"array"</span>, CRT <span class="op">=</span> <span class="va">example</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624 </span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -1.156624</span></span></code></pre>
<p>There is a clear downward trend in the ICC estimates, as cluster size
increases (Figure 3.1). The ICC expected for a trial in this, or
similar, geographies can be read off the curve. Note that the ICC is
expected to vary not just with cluster size, but also to vary between
different outcomes.</p>
<p>
<img src="example3b.r-1.png"><br><em>Fig 3.1 Intracluster correlation
by size of cluster</em>
</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
