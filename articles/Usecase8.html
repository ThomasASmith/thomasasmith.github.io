<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use Case 08: Eggs - to fry or scramble? • CRTspat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Case 08: Eggs - to fry or scramble?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Usecase1.html">Use Case 01: Algorithmic specification of clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase10.html">Use Case 10: Power sample size and bias calculations using a diffusion model for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase2.html">Use Case 02: Simulation of trials with geographical spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase3.html">Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase4.html">Use Case 04: Estimation of optimal cluster size for a trial with pre-determined buffer width</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase5.html">Use Case 05: Analysis of trials (including methods for analysing spillover)</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase6.html">Use Case 06: Thematic mapping of the geography of a CRT</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase7.html">Use Case 07: Power and sample size calculations allowing for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase8.html">Use Case 08: Eggs - to fry or scramble?</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase9.html">Use Case 09: Preparation of datasets for `CRTspat`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use Case 08: Eggs - to fry or scramble?</h1>
            
      

      <div class="d-none name"><code>Usecase8.Rmd</code></div>
    </div>

    
    
<p>In trials of malaria interventions, a ‘fried-egg’ design is often
used to avoid the downward bias in the estimates of efficacy caused by
spillover. This entails estimating the outcome only from the cores of
the clusters. However, the intervention must also be introduced in the
buffer zone, so the trial may be very expensive if there are high per
capita intervention costs. Since the buffer zone is excluded from data
collection, there are usually no data on whether the buffer is large
enough to avoid spillover effects. A precautionary approach with large
buffer zones is therefore the norm. However with ‘fried-eggs’ there are
no data on the scale of the spillover, so if the effect was swamped by
unexpectedly large spillover, this would be indistinguishable from
failure of the intervention.</p>
<p>The alternative design is to sample in the buffer zones, accepting
some degree of spillover. The data analysis might then be used to
estimate the scale of spillover (see <a href="Usecase5.html">Use Case
5</a>). The statistical model might be to adjust the estimate of effect
size for the spillover effect, or to decide which contaminated areas to
exclude <em>post hoc</em> from the definitive analysis (based on
pre-defined criteria). This is expected to lead to some loss of power,
compared to collecting the same amount of outcome data from the core
area alone (though this might be compensated for by increasing data
collection), but is likely to be less complicated to organise, allowing
the trial to be carried out over a much smaller area, with far fewer
locations needing to be randomized (see <a href="Usecase4.html">Use Case
4</a>).</p>
<p>In this example, the effects of reducing the numbers of observations
on power and bias are evaluated in simulated datasets. To compare
‘fried-egg’ strategies with comparable designs that sample the whole
area, sets of locations are removed, either randomly from the whole
area, or systematically depending on the distance from the boundary
between arms. As in <a href="Usecase7.html">Use Case 7</a>, spatially
homogeneous background disease rates are assigned, using
<code>propensity &lt;- 1</code>, fixed values are used for the outcome
in the control arm, the target ICC of the simulations and the number of
clusters in each arm of the trial. Efficacy is also fixed at 0.4. The
spillover interval is sampled from a uniform(0, 1.5km) distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CRTspat</span><span class="op">)</span></span>
<span><span class="co"># use the locations only from example dataset (as with Use Case 7)</span></span>
<span><span class="va">example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">"exampleCRT.txt"</span><span class="op">)</span></span>
<span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="va">example</span><span class="op">$</span><span class="va">trial</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>, <span class="st">"denom"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">trial</span><span class="op">$</span><span class="va">propensity</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">CRT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># specify:</span></span>
<span><span class="co">#   prevalence in the absence of intervention;</span></span>
<span><span class="co">#   anticipated ICC;</span></span>
<span><span class="co">#   clusters in each arm</span></span>
<span><span class="va">outcome0</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span>
<span><span class="va">ICC</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="co"># the number of trial simulations required (a small number, is used for testing, the plots are based on 1000)</span></span>
<span><span class="va">nsimulations</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">spillover_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsimulations</span>,<span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">radii</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">proportions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">radii</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span>, <span class="va">proportions</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>Two user functions are required:</p>
<ul>
<li>randomization and trial simulation</li>
<li>analysis of each simulated trial with different sets of locations
removed</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analyseReducedCRT</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">CRT</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">trial</span> <span class="op">&lt;-</span> <span class="va">CRT</span><span class="op">$</span><span class="va">trial</span></span>
<span>  <span class="va">radius</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="st">"radius"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">proportion</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="st">"proportion"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">nlocations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">radius</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">radius</span> <span class="op">&lt;-</span> <span class="va">radius</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span>    <span class="va">trial</span><span class="op">$</span><span class="va">num</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">trial</span><span class="op">$</span><span class="va">nearestDiscord</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">radius</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">proportion</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># add random variation to proportion to avoid heaping</span></span>
<span>    <span class="va">proportion</span> <span class="op">&lt;-</span> <span class="va">proportion</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span>    <span class="va">trial</span><span class="op">$</span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nlocations</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">proportion</span>, <span class="cn">NA</span>, <span class="va">trial</span><span class="op">$</span><span class="va">num</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">trial</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trial</span><span class="op">$</span><span class="va">num</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">resX</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">trial</span>,method <span class="op">=</span> <span class="st">"LME4"</span>, cfunc <span class="op">=</span> <span class="st">"X"</span><span class="op">)</span></span>
<span>  <span class="va">resZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">trial</span>,method <span class="op">=</span> <span class="st">"LME4"</span>, cfunc <span class="op">=</span> <span class="st">"Z"</span><span class="op">)</span></span>
<span>  <span class="va">LRchisq</span> <span class="op">&lt;-</span> <span class="va">resZ</span><span class="op">$</span><span class="va">pt_ests</span><span class="op">$</span><span class="va">deviance</span> <span class="op">-</span> <span class="va">resX</span><span class="op">$</span><span class="va">pt_ests</span><span class="op">$</span><span class="va">deviance</span></span>
<span>  <span class="va">significant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">LRchisq</span> <span class="op">&gt;</span> <span class="fl">3.84</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>radius <span class="op">=</span> <span class="va">radius</span>,</span>
<span>                 proportion <span class="op">=</span> <span class="va">proportion</span>,</span>
<span>                 observations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span>,</span>
<span>                 significant <span class="op">=</span> <span class="va">significant</span>,</span>
<span>                 effect_size <span class="op">=</span> <span class="va">resX</span><span class="op">$</span><span class="va">pt_ests</span><span class="op">$</span><span class="va">effect_size</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># randomization and trial simulation</span></span>
<span><span class="va">randomize_simulate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">spillover</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span><span class="va">CRT</span>, c <span class="op">=</span> <span class="va">c</span>, algo <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="fl">0.4</span>, generateBaseline <span class="op">=</span> <span class="cn">FALSE</span>, outcome0 <span class="op">=</span> <span class="va">outcome0</span>,</span>
<span>                ICC_inp <span class="op">=</span> <span class="va">ICC</span>, spillover_interval <span class="op">=</span> <span class="va">spillover</span>,</span>
<span>                matchedPair <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="st">"proportion"</span>, denominator <span class="op">=</span> <span class="st">"denom"</span>, tol <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>  <span class="co"># The results are collected in a data frame</span></span>
<span>  <span class="va">sub_results_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">scenarios</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>,  FUN <span class="op">=</span> <span class="va">analyseReducedCRT</span>, CRT <span class="op">=</span> <span class="va">ex</span><span class="op">)</span></span>
<span>  <span class="va">sub_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sub_results_matrix</span>, <span class="va">as.data.frame</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">sub_results</span><span class="op">$</span><span class="va">spillover_interval</span> <span class="op">&lt;-</span> <span class="va">spillover</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sub_results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Collect all the analysis results and plot. Note that some analyses
result in warnings (because of problems computing some of the
descriptive statistics when the number of observations in some clusters
is very small)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>simulation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>                radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>               proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>               observations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>               significant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>               effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>               gamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">simulation</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">spillover</span> <span class="kw">in</span> <span class="va">spillover_vec</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">simulation</span> <span class="op">&lt;-</span> <span class="va">simulation</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">sub_results</span> <span class="op">&lt;-</span> <span class="fu">randomize_simulate</span><span class="op">(</span><span class="va">spillover</span><span class="op">)</span></span>
<span>  <span class="va">sub_results</span><span class="op">$</span><span class="va">simulation</span> <span class="op">&lt;-</span> <span class="va">simulation</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">results</span>,<span class="va">sub_results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">fried</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">radius</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">'fried'</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">proportion</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">'scrambled'</span>, <span class="st">'neither'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">effect_size</span> <span class="op">-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig8_1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observations</span>, y <span class="op">=</span> <span class="va">significant</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fried</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#b2df8a"</span>,<span class="st">"#D55E00"</span>,<span class="st">"#0072A7"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Number of locations in analysis'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Power'</span><span class="op">)</span></span>
<span><span class="va">fig8_1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">spillover_interval</span>, y <span class="op">=</span> <span class="va">significant</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fried</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#b2df8a"</span>,<span class="st">"#D55E00"</span>,<span class="st">"#0072A7"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Simulated spillover interval (km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Power'</span><span class="op">)</span></span>
<span><span class="va">fig8_1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observations</span>, y <span class="op">=</span> <span class="va">bias</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fried</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#b2df8a"</span>,<span class="st">"#D55E00"</span>,<span class="st">"#0072A7"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Number of locations in analysis'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Bias'</span><span class="op">)</span></span>
<span><span class="va">fig8_1d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">spillover_interval</span>, y <span class="op">=</span> <span class="va">bias</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fried</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#b2df8a"</span>,<span class="st">"#D55E00"</span>,<span class="st">"#0072A7"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Simulated spillover interval (km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Bias'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">fig8_1a</span>, <span class="va">fig8_1b</span>, <span class="va">fig8_1c</span>, <span class="va">fig8_1d</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span><span class="op">)</span>, label_size <span class="op">=</span> <span class="fl">14</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h4>
<p>Figure 8.1. is are based on analysing 1000 simulated datasets (12,000
scenarios in all). The power is calculated as the proportion of
significance tests with likelihood ratio p &lt; 0.05.</p>
<p>The fried-egg design suffers little loss of power with exclusion of
observations until the sample size is less than about 750 (the
suggestion that there is a maximum at a sample size of about 900
locations is presumably an effect of the smoothing of the results). The
‘scrambled’ egg trials lose power with each reduction in the number of
observations (Figure 8.1a), but substantive loss of power occurs only
with spillover interval of 1 km or more in this dataset. The fried egg
designs largely avoid this loss of power (Figure 8.1b) but are less
powerful on average when the spillover interval is less that 0.5 km.</p>
<p>In these simulations, the lme4 estimates of the efficacy are biased
slightly downwards (i.e. the bias has negative sign). The absolute bias
was least when some of the locations were excluded (Figure 8.1c). There
is less absolute bias with the fried-egg designs but the effect is small
except when the simulated spillover interval is very large (Figure
8.1d). The difference in bias between ‘fried’ and ‘scrambled’ egg
designs is modest in relation to the scale of the overall bias.</p>
<p>
<img src="example8c.r-1.png" alt=""><br><em>Fig 8.1 Power and bias by
number of locations in analysis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="bold">—-</mtext><annotation encoding="application/x-tex">\color{purple}{\textbf{----}}</annotation></semantics></math>
: Randomly sampled locations removed;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="bold">—-</mtext><annotation encoding="application/x-tex">\color{green}{\textbf{----}}</annotation></semantics></math>
: Fried-egg- locations in boundary zone removed. </em>
</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
