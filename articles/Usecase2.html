<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use Case 02: Simulation of trials with geographical spillover â€¢ CRTspat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Case 02: Simulation of trials with geographical spillover">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Usecase1.html">Use Case 01: Algorithmic specification of clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase2.html">Use Case 02: Simulation of trials with geographical spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase3.html">Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase4.html">Use Case 04: Estimation of optimal cluster size for a trial with pre-determined buffer width</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase5.html">Use Case 05: Analysis of trials (including methods for analysing spillover)</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase6.html">Use Case 06: Thematic mapping of the geography of a CRT</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase7.html">Use Case 07: Power and sample size calculations allowing for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase8.html">Use Case 08: Eggs - to fry or scramble?</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase9.html">Use Case 09: Preparation of datasets for `CRTspat`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use Case 02: Simulation of trials with geographical spillover</h1>
            
      

      <div class="d-none name"><code>Usecase2.Rmd</code></div>
    </div>

    
    
<p>Effects of settlement patterns, choices of cluster size and buffer
widths, and the extent of spillover between arms on the outcomes of CRTs
do not lend themselves to mathematical analysis. Simulations of trials
are used to explore the effects of these variables on trial power and on
the robustness of statistical methodologies.</p>
<p>Trials can be simulated using the <code>simulateCRT</code> function,
which augments a <code>trial</code> data frame (created externally) or
object of class <code>CRTsp</code> (created by package functions) with
simulated outcome data. The input object must be given location
information and both cluster and arm assignments (see <a href="Usecase1.html">Use Case 1</a>) (or the package can generate these
if the objective is purely simulation.</p>
<p>Information about the underlying spatial pattern of disease is used
in the form of the intra-cluster correlation of the outcome, which is
input to the simulation as variable <code>ICC_inp</code>, and of the
<code>propensity</code>. The former takes a single value for the chosen
design. The latter takes a positive real value for each location. In the
case of malaria, <code>propensity</code> can be thought of as measuring
exposure to infectious mosquitoes.</p>
<p><code>ICC_inp</code> and <code>propensity</code> may either be
estimated from other datasets or supplied by the user. The behaviour of
the function depends on which variables are supplied, and the value of
<code>generateBaseline</code>, as follows:</p>
<table class="table">
<colgroup>
<col width="42%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th align="left">Data supplied by the user</th>
<th align="left">Function behaviour</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">
<code>propensity</code> supplied by user</td>
<td align="left">Baseline data are created by sampling around
<code>propensity</code>
</td>
</tr>
<tr class="even">
<td align="left">Baseline data are supplied by user and
<code>propensity</code> is not supplied</td>
<td align="left">
<code>propensity</code> is created from the baseline
data</td>
</tr>
<tr class="odd">
<td align="left">Neither baseline data nor <code>propensity</code> are
supplied</td>
<td align="left">
<code>propensity</code> is generated using normal
kernels, with the bandwidth adjusted to achieve the input value of the
<code>ICC_inp</code> (after the further smoothing stage to simulate
spillover (see below))</td>
</tr>
</tbody>
</table>
<p>The effect of intervention is simulated as a fixed percentage
reduction in the <code>propensity</code>. Contamination or spillover
between trial arms is then modelled as a additional smoothing process
applied to the intervention-adjusted <code>propensity</code> via a
further bivariate normal kernel. In the case of mosquito borne disease
this is proposed as an approximation to the effect of mosquito movement.
The degree of spillover is specified either as a spillover interval with
the <code>spillover_interval</code> parameter, or as <code>sd</code>,
the bandwidth of the corresponding normal kernel. If both are provided
then it is the value of <code>spillover_interval</code> that is
used.</p>
<div class="section level4">
<h4 id="example-with-baseline-data-provided-as-proportions">Example with baseline data provided as proportions<a class="anchor" aria-label="anchor" href="#example-with-baseline-data-provided-as-proportions"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CRTspat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">example_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">'example_site.csv'</span><span class="op">)</span></span>
<span><span class="va">example_locations</span><span class="op">$</span><span class="va">base_denom</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">example_randomized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">example_locations</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregateCRT.html">aggregateCRT</a></span><span class="op">(</span>auxiliaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RDT_test_result"</span>, <span class="st">"base_denom"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">50</span>, algorithm <span class="op">=</span> <span class="st">'NN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>matchedPair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example_randomized</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##                Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x        -3.20    -1.40    -0.30    -0.07     1.26     5.16   </span></span>
<span><span class="co">##       y        -5.08    -2.84     0.19     0.05     2.49     6.16   </span></span>
<span><span class="co">## nearestDiscord -3.47    -0.49     0.04     0.14     0.74     3.30   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  27.6 sq.km</span></span>
<span><span class="co">## Total area (convex hull) :  48.2 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          -                        </span></span>
<span><span class="co">## Coordinate system                      (x, y)                        </span></span>
<span><span class="co">## Locations:                                                      1181                        </span></span>
<span><span class="co">## Available clusters (across both arms)                           24                        </span></span>
<span><span class="co">##   Per cluster mean number of points                             49.2                        </span></span>
<span><span class="co">##   Per cluster s.d. number of points                             3.9                        </span></span>
<span><span class="co">## Cluster randomization:                      Independently randomized                        </span></span>
<span><span class="co">## No power calculations to report          -                        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Other variables in dataset</span></span>
<span><span class="co">## --------------------------          RDT_test_result  base_denom</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example_randomized</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">example2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span><span class="va">example_randomized</span>,</span>
<span>           effect <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>           outcome0 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>           generateBaseline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>           baselineNumerator <span class="op">=</span> <span class="st">"RDT_test_result"</span>,</span>
<span>           baselineDenominator <span class="op">=</span> <span class="st">"base_denom"</span>,</span>
<span>           ICC_inp <span class="op">=</span> <span class="fl">0.05</span>, spillover_interval <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example2a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##                Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x        -3.20    -1.40    -0.30    -0.07     1.26     5.16   </span></span>
<span><span class="co">##       y        -5.08    -2.84     0.19     0.05     2.49     6.16   </span></span>
<span><span class="co">## nearestDiscord -3.47    -0.49     0.04     0.14     0.74     3.30   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  27.6 sq.km</span></span>
<span><span class="co">## Total area (convex hull) :  48.2 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          -                        </span></span>
<span><span class="co">## Coordinate system                      (x, y)                        </span></span>
<span><span class="co">## Locations:                                                      1181                        </span></span>
<span><span class="co">## Available clusters (across both arms)                           24                        </span></span>
<span><span class="co">##   Per cluster mean number of points                             49.2                        </span></span>
<span><span class="co">##   Per cluster s.d. number of points                             3.9                        </span></span>
<span><span class="co">## Cluster randomization:                      Independently randomized                        </span></span>
<span><span class="co">## No power calculations to report          -                        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Other variables in dataset</span></span>
<span><span class="co">## --------------------------          RDT_test_result  base_denom  denom  propensity  num</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span><span class="va">examplemesh100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">"examplemesh100.rds"</span><span class="op">)</span></span>
<span><span class="va">example2aanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span>trial<span class="op">=</span><span class="va">example2a</span>, method <span class="op">=</span> <span class="st">'T'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example2aanalysis</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## =====================CLUSTER RANDOMISED TRIAL ANALYSIS =================</span></span>
<span><span class="co">## Analysis method:  T </span></span>
<span><span class="co">## Link function:  logit </span></span>
<span><span class="co">## Model formula:  arm + (1 | cluster) </span></span>
<span><span class="co">## No modelling of spillover </span></span>
<span><span class="co">## Estimates:       Control:  0.386  (95% CL:  0.301 0.478 )</span></span>
<span><span class="co">##             Intervention:  0.191  (95% CL:  0.131 0.269 )</span></span>
<span><span class="co">##                 Efficacy:  0.506  (95% CL:  0.351 0.784 )</span></span>
<span><span class="co">## Coefficient of variation:  49.3 %  (95% CL:  36.5 77.5 )</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## P-value (2-sided):  0.001224732</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example2aanalysis</span><span class="op">)</span></span>
<span><span class="va">example2aINLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span>trial<span class="op">=</span><span class="va">example2a</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">'INLA'</span>, link<span class="op">=</span><span class="st">'logit'</span>, cfunc <span class="op">=</span> <span class="st">'Z'</span>,</span>
<span>                 clusterEffects <span class="op">=</span> <span class="cn">FALSE</span>, spatialEffects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 requireMesh <span class="op">=</span> <span class="cn">TRUE</span>, inla_mesh <span class="op">=</span> <span class="va">examplemesh100</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example2aINLA</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'prediction'</span>,</span>
<span>  showClusterBoundaries <span class="op">=</span> <span class="cn">TRUE</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>
<img src="example2a.r-1.png" alt=""><br><em>Fig 2.1 Map of
allocations of clusters to arms</em>
</p>
<p>
<img src="example2a.r-2.png" alt=""><br><em>Fig 2.2 Plot of data by
distance to other arm</em>
</p>
<p>
<img src="example2a.r-3.png" alt=""><br><em>Fig 2.3 Smoothed outcome
from geostatistical model</em>
</p>
</div>
<div class="section level4">
<h4 id="example-with-infectiousness-proxy-surface-generated-externally">Example with infectiousness proxy surface generated externally<a class="anchor" aria-label="anchor" href="#example-with-infectiousness-proxy-surface-generated-externally"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># Simulate a site with 2000 locations</span></span>
<span><span class="va">new_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span>geoscale <span class="op">=</span> <span class="fl">2</span>, locations<span class="op">=</span><span class="fl">2000</span>, kappa<span class="op">=</span><span class="fl">3</span>, mu<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span>
<span><span class="co"># propensity surface generated as an arbitrary linear function of x the co-ordinate</span></span>
<span><span class="va">new_site</span><span class="op">$</span><span class="va">trial</span><span class="op">$</span><span class="va">propensity</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">new_site</span><span class="op">$</span><span class="va">trial</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">new_site</span><span class="op">$</span><span class="va">trial</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">example2b</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">new_site</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">40</span>, algorithm <span class="op">=</span> <span class="st">'NN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>matchedPair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>               outcome0 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               generateBaseline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               ICC_inp <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>               spillover_interval <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## =====================    SIMULATION OF CLUSTER RANDOMISED TRIAL    =================</span></span></code></pre>
<pre><code><span><span class="co">## *** computed distance to nearest measurements in discordant arm ***</span></span></code></pre>
<pre><code><span><span class="co">## Estimating the smoothing required to achieve the target ICC of 0.05</span></span></code></pre>
<pre><code>## 
tol: 0.005 loss = 0.0034482803603185 </code></pre>
<pre><code>## 
bandwidth: 0.0117436284570214  ICC = 0.108722060252673 loss = 0.0034482803603185 </code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example2b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##                Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x        -8.73    -5.16    -1.03     0.00     5.17    11.26   </span></span>
<span><span class="co">##       y        -9.55    -4.42    -0.58     0.00     4.56    10.45   </span></span>
<span><span class="co">## nearestDiscord -4.20    -0.93     0.00     0.03     0.96     3.94   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  181 sq.km</span></span>
<span><span class="co">## Total area (convex hull) :  396 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          -                        </span></span>
<span><span class="co">## Coordinate system                      (x, y)                        </span></span>
<span><span class="co">## Locations:                                                      2000                        </span></span>
<span><span class="co">## Available clusters (across both arms)                           50                        </span></span>
<span><span class="co">##   Per cluster mean number of points                             40                        </span></span>
<span><span class="co">##   Per cluster s.d. number of points                             0                        </span></span>
<span><span class="co">## Cluster randomization:                      Independently randomized                        </span></span>
<span><span class="co">## No power calculations to report          -                        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Other variables in dataset</span></span>
<span><span class="co">## --------------------------          denom  propensity  num  base_denom  base_num</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">example2b</span>, method <span class="op">=</span> <span class="st">'GEE'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     (Intercept) armintervention </span></span>
<span><span class="co">##      -0.6322523      -0.4504233</span></span></code></pre>
<pre><code><span><span class="co">## No non-linear parameter.  No fixed effects of distance -</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results2b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## =====================CLUSTER RANDOMISED TRIAL ANALYSIS =================</span></span>
<span><span class="co">## Analysis method:  GEE </span></span>
<span><span class="co">## Link function:  logit </span></span>
<span><span class="co">## Model formula:  arm </span></span>
<span><span class="co">## No modelling of spillover </span></span>
<span><span class="co">## Estimates:       Control:  0.347  (95% CL:  0.292 0.406 )</span></span>
<span><span class="co">##             Intervention:  0.253  (95% CL:  0.216 0.294 )</span></span>
<span><span class="co">##                 Efficacy:  0.271  (95% CL:  0.0608 0.433 )</span></span>
<span><span class="co">## Coefficient of variation:  50.4 %  (95% CL:  40.5 67.3 )</span></span>
<span><span class="co">## Intracluster correlation (ICC)  :  0.109  (95% CL:  NA NA )</span></span>
<span><span class="co">## </span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example2b</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'clusters'</span>, showClusterLabels <span class="op">=</span> <span class="cn">TRUE</span>, maskbuffer <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>
<img src="example2b.r-1.png" alt=""><br><em>Fig 2.4 Map of clusters
in simulated trial</em>
</p>
</div>
<div class="section level4">
<h4 id="example-with-baseline-generated-from-user-provided-values-of-the-overall-initial-prevalence-and-icc">Example with baseline generated from user-provided values of the
overall initial prevalence and ICC<a class="anchor" aria-label="anchor" href="#example-with-baseline-generated-from-user-provided-values-of-the-overall-initial-prevalence-and-icc"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># use co-ordinates, cluster and arm assignments, and baseline data from `example_simulated`</span></span>
<span><span class="va">example2c</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span>geoscale <span class="op">=</span> <span class="fl">2</span>, locations<span class="op">=</span><span class="fl">2000</span>, kappa<span class="op">=</span><span class="fl">3</span>, mu<span class="op">=</span><span class="fl">40</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">40</span>, algorithm <span class="op">=</span> <span class="st">'NN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>matchedPair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>       outcome0 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>       generateBaseline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       baselineNumerator <span class="op">=</span> <span class="st">'base_num'</span>,</span>
<span>       baselineDenominator <span class="op">=</span> <span class="st">'base_denom'</span>,</span>
<span>       ICC_inp <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>       spillover_interval <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## =====================    SIMULATION OF CLUSTER RANDOMISED TRIAL    =================</span></span></code></pre>
<pre><code><span><span class="co">## *** computed distance to nearest measurements in discordant arm ***</span></span></code></pre>
<pre><code><span><span class="co">## Estimating the smoothing required to achieve the target ICC of 0.08</span></span></code></pre>
<pre><code>## 
tol: 0.005 loss = 0.00125339394677766 </code></pre>
<pre><code>## 
bandwidth: 0.0246321272161409  ICC = 0.115403304178814 loss = 0.00125339394677766 </code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">example2c</span>, method <span class="op">=</span> <span class="st">'GEE'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     (Intercept) armintervention </span></span>
<span><span class="co">##      -0.6677537      -0.3730238</span></span></code></pre>
<pre><code><span><span class="co">## No non-linear parameter.  No fixed effects of distance -</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results2c</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## =====================CLUSTER RANDOMISED TRIAL ANALYSIS =================</span></span>
<span><span class="co">## Analysis method:  GEE </span></span>
<span><span class="co">## Link function:  logit </span></span>
<span><span class="co">## Model formula:  arm </span></span>
<span><span class="co">## No modelling of spillover </span></span>
<span><span class="co">## Estimates:       Control:  0.339  (95% CL:  0.281 0.402 )</span></span>
<span><span class="co">##             Intervention:  0.261  (95% CL:  0.208 0.322 )</span></span>
<span><span class="co">##                 Efficacy:  0.23  (95% CL:  -0.0152 0.419 )</span></span>
<span><span class="co">## Coefficient of variation:  51.9 %  (95% CL:  41.6 69.6 )</span></span>
<span><span class="co">## Intracluster correlation (ICC)  :  0.115  (95% CL:  NA NA )</span></span>
<span><span class="co">## </span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
