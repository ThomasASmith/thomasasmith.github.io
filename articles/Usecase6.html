<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CRTspat">
<title>Use Case 06: Thematic mapping of the geography of a CRT • CRTspat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Case 06: Thematic mapping of the geography of a CRT">
<meta property="og:description" content="CRTspat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Usecase1.html">Use Case 01: Algorithmic specification of clusters</a>
    <a class="dropdown-item" href="../articles/Usecase2.html">Use Case 02: Simulation of trials with geographical spillover</a>
    <a class="dropdown-item" href="../articles/Usecase3.html">Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</a>
    <a class="dropdown-item" href="../articles/Usecase4.html">Use Case 04: Estimation of optimal cluster size for a trial with pre-determined buffer width</a>
    <a class="dropdown-item" href="../articles/Usecase5.html">Use Case 05: Analysis of trials (including methods for analysing spillover)</a>
    <a class="dropdown-item" href="../articles/Usecase6.html">Use Case 06: Thematic mapping of the geography of a CRT</a>
    <a class="dropdown-item" href="../articles/Usecase7.html">Use Case 07: Power and sample size calculations allowing for spillover</a>
    <a class="dropdown-item" href="../articles/Usecase8.html">Use Case 08: Eggs - to fry or scramble?</a>
    <a class="dropdown-item" href="../articles/Usecase9.html">Use Case 09: Preparation of datasets for `CRTspat`</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Use Case 06: Thematic mapping of the geography of a CRT</h1>
            
      
      
      <div class="d-none name"><code>Usecase6.Rmd</code></div>
    </div>

    
    
<p><code>CRTspat</code> is intended to facilitate thematic mapping of
the geography of a CRT at each stage from enumeration of the trial
population to data analysis. Graphical outputs are generated with
<code>ggplot2()</code>. In addition there is a function,
<code><a href="../reference/CRTwrite.html">CRTwrite()</a></code> to export the thematic layers and shapefiles to
GIS formats.</p>
<p>The same <code><a href="../reference/plotCRT.html">plotCRT()</a></code> function is used at each stage in the
trial (see below), with the functionality available expanding as more
fields are populated in the <code>CRTsp</code> object. When applied to
output from <code><a href="../reference/CRTanalysis.html">CRTanalysis()</a></code> <code><a href="../reference/plotCRT.html">plotCRT()</a></code> that
analyse the spillover interval, an expanded set of thematic maps are
available, including overlay plots showing the spillover zone (i.e. the
subset of the study area estimated to have effects of spillover) and
thematic maps of spatial predictions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using the same dataset as for Use Case 1.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CRTspat</span><span class="op">)</span></span>
<span><span class="va">exampleCRT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">'exampleCRT.txt'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">exampleCRT</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'none'</span>, showLocations<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>
<img src="example6a.r-1.png"><br><em>Fig 6.1 Locations </em>
</p>
<p>If the clusters have been established, a map can be drawn showing
where they are located. The clusters can be distinguished by colour or
by number. To ensure that the image is not too crowded, by default the
locations are not shown (but they can be shown if required).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">exampleCRT</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'clusters'</span>, showClusterLabels <span class="op">=</span> <span class="cn">TRUE</span>, labelsize <span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>
<img src="example6b.r-1.png"><br><em>Fig 6.2 Clusters </em>
</p>
<p>Similarly, the map of arms is available if the trial has been
randomized. Buffer zones can be plotted on this map.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">exampleCRT</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'arms'</span>, showLocations<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">exampleCRT</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'arms'</span>, showBuffer<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        showClusterBoundaries <span class="op">=</span> <span class="cn">FALSE</span>, buffer_width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Buffer includes locations within 500m of the opposing arm</span></span></code></pre>
<p>
<img src="example6c.r-1.png"><br><em>Fig 6.3 Arms with locations
</em>
</p>
<p>
<img src="example6c.r-2.png"><br><em>Fig 6.4 Arms with 500m buffer
zone shaded </em>
</p>
<p>Once data have been collected, <code><a href="../reference/plotCRT.html">plotCRT()</a></code> can be used to
generate a bar plot to illustrate how much of the data are found close
to the boundary between the arms.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">exampleCRT</span>, map <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>
<img src="example6d.r-1.png"><br><em>Fig 6.5 Numbers of observations
by distance from boundary</em>
</p>
<p>The results of the data analysis can be illustrated with further
graphics. The blue shaded section of Figure 6.8 indicates the spillover
zone, corresponding to those locations that fall within the central 95%
of the estimated sigmoid of the of the effect size by distance from the
boundary between the arms.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">exampleCRT</span>, cfunc <span class="op">=</span> <span class="st">"P"</span>, method <span class="op">=</span> <span class="st">"LME4"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Estimated scale parameter: 0.45 Signed distance -Signed distance to other arm (km)</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## =====================CLUSTER RANDOMISED TRIAL ANALYSIS =================</span></span>
<span><span class="co">## Analysis method:  LME4 </span></span>
<span><span class="co">## Link function:  logit </span></span>
<span><span class="co">## Measure of distance or surround: Signed distance to other arm (km)</span></span>
<span><span class="co">## Estimated scale parameter: 0.45</span></span>
<span><span class="co">## Model formula:  pvar + (1 | cluster) </span></span>
<span><span class="co">## Error function model for spillover</span></span>
<span><span class="co">## Estimates:       Control:  0.418  (95% CL:  0.331 0.511 )</span></span>
<span><span class="co">##             Intervention:  0.186  (95% CL:  0.135 0.251 )</span></span>
<span><span class="co">##                 Efficacy:  0.554  (95% CL:  0.33 0.703 )</span></span>
<span><span class="co">## Spillover interval(km):      4.22  (95% CL:  4.2 4.24 )</span></span>
<span><span class="co">## % locations contaminated: 91.6  (95% CL:  90.6 92.2 %)</span></span>
<span><span class="co">## Total effect            : 0.231  (95% CL:  0.116 0.347 )</span></span>
<span><span class="co">## Ipsilateral Spillover   : 0.0234  (95% CL:  0.0129 0.0325 )</span></span>
<span><span class="co">## Contralateral Spillover : 0.0417  (95% CL:  0.0195 0.0655 )</span></span>
<span><span class="co">## Coefficient of variation:  41.6 %  (95% CL:  31.2 63.1 )</span></span>
<span><span class="co">## deviance:  1374.215 </span></span>
<span><span class="co">## AIC     :  1382.215 including penalty for the spillover scale parameter</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">analysis</span>, map <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">analysis</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'arms'</span>, showBuffer<span class="op">=</span><span class="cn">TRUE</span>, showClusterBoundaries <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Buffer corresponds to estimated spillover zone</span></span></code></pre>
<p>
<img src="example6e.r-1.png"><br><em>Fig 6.6 Plot of estimated
spillover function </em>
</p>
<p>
<img src="example6e.r-2.png"><br><em>Fig 6.7 Arms with spillover zone
shaded </em>
</p>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>In this example, a large proportion of the data points are close to
the boundary between the arms. The analysis (based on simulated
spillover) suggests that there are effects of spillover far beyond a
500m buffer. However this does not necessarily mean that the spillover
leads to a large bias or loss in power (see <a href="Usecase7.html">Use
Case 7</a>).</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
