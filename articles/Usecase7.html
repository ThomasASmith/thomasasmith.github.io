<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use Case 07: Power and sample size calculations allowing for spillover â€¢ CRTspat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Case 07: Power and sample size calculations allowing for spillover">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Usecase1.html">Use Case 01: Algorithmic specification of clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase2.html">Use Case 02: Simulation of trials with geographical spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase3.html">Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase4.html">Use Case 04: Estimation of optimal cluster size for a trial with pre-determined buffer width</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase5.html">Use Case 05: Analysis of trials (including methods for analysing spillover)</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase6.html">Use Case 06: Thematic mapping of the geography of a CRT</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase7.html">Use Case 07: Power and sample size calculations allowing for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase8.html">Use Case 08: Eggs - to fry or scramble?</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase9.html">Use Case 09: Preparation of datasets for `CRTspat`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use Case 07: Power and sample size calculations allowing for spillover</h1>
            
      

      <div class="d-none name"><code>Usecase7.Rmd</code></div>
    </div>

    
    
<p>Contamination between the arms of a trial leads to downward bias in
the estimates of efficacy In the case of malaria, this spillover is
mainly caused by mosquito movement, and is therefore expected to be
greatest near to the boundary between the trial arms.</p>
<p>Because the effective distance over which substantial spillover
occurs is generally not known, sensitivity analyses must be used to get
an idea of how great these effects are likely to be. The following
workflow, similar to that used for <a href="Usecase3.html">Use Case
3</a>, explores the likely bias and loss of power for one specific
simulated setting.</p>
<p>In this simple example, spatially homogeneous background disease
rates are assigned, using <code>propensity &lt;- 1</code> A small number
of simulations is specified for testing (here 2, a much larger number,
at least several thousands is used for the definitive analysis). In this
example, a fixed value for the outcome in the control arm, the target
ICC of the simulations, and the number of clusters in each arm of the
trial. input. Efficacy is sampled from a uniform(0, 0.6) distribution,
and the simulated spillover interval from a uniform(0, 1.5km)
distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CRTspat</span><span class="op">)</span></span>
<span><span class="co"># The locations only are taken from the example dataset. The cluster, arm, and outcome assignments are replaced</span></span>
<span><span class="va">example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">"exampleCRT.txt"</span><span class="op">)</span></span>
<span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="va">example</span><span class="op">$</span><span class="va">trial</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>, <span class="st">"denom"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">trial</span><span class="op">$</span><span class="va">propensity</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">nsimulations</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">CRT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">outcome0</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span>
<span><span class="va">ICC</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsimulations</span>,<span class="fl">0</span>,<span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co"># Data frame of input spillover interval</span></span>
<span><span class="va">spillover_interval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsimulations</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="va">effect</span>, spillover_interval <span class="op">=</span> <span class="va">spillover_interval</span><span class="op">)</span></span></code></pre></div>
<p>A user function is defined for randomizing and analysing each
simulated trial</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CRTscenario7</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span><span class="va">CRT</span>, c <span class="op">=</span> <span class="va">c</span>, algo <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="va">input</span><span class="op">[[</span><span class="st">"effect"</span><span class="op">]</span><span class="op">]</span>, generateBaseline <span class="op">=</span> <span class="cn">FALSE</span>, outcome0 <span class="op">=</span> <span class="va">outcome0</span>,</span>
<span>                    ICC_inp <span class="op">=</span> <span class="va">ICC</span>, spillover_interval <span class="op">=</span> <span class="va">input</span><span class="op">[[</span><span class="st">"spillover_interval"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                    matchedPair <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="st">"proportion"</span>, denominator <span class="op">=</span> <span class="st">"denom"</span>, tol <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>    <span class="va">sd</span> <span class="op">&lt;-</span> <span class="va">spillover_interval</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">contaminate_pop_pr_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">trial</span><span class="op">$</span><span class="va">nearestDiscord</span><span class="op">)</span> <span class="op">&lt;</span></span>
<span>              <span class="fl">0.5</span> <span class="op">*</span> <span class="va">input</span><span class="op">[[</span><span class="st">"spillover_interval"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">trial</span><span class="op">)</span></span>
<span>    <span class="va">contaminate_pop_pr_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">trial</span><span class="op">$</span><span class="va">nearestDiscord</span><span class="op">)</span> <span class="op">&lt;</span></span>
<span>              <span class="va">input</span><span class="op">[[</span><span class="st">"spillover_interval"</span><span class="op">]</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">trial</span><span class="op">)</span></span>
<span>    <span class="va">examplePower</span> <span class="op">=</span> <span class="fu"><a href="../reference/CRTpower.html">CRTpower</a></span><span class="op">(</span>trial <span class="op">=</span> <span class="va">ex</span>, desiredPower <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                           effect<span class="op">=</span><span class="va">input</span><span class="op">[[</span><span class="st">"effect"</span><span class="op">]</span><span class="op">]</span>, yC<span class="op">=</span><span class="va">outcome0</span>, outcome_type <span class="op">=</span> <span class="st">'d'</span>, ICC <span class="op">=</span> <span class="va">ICC</span>, c <span class="op">=</span> <span class="va">c</span><span class="op">)</span></span>
<span>    <span class="va">nominalpower</span> <span class="op">&lt;-</span>  <span class="va">examplePower</span><span class="op">$</span><span class="va">geom_full</span><span class="op">$</span><span class="va">power</span></span>
<span>    <span class="va">Tanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">ex</span>, method <span class="op">=</span> <span class="st">"T"</span><span class="op">)</span></span>
<span>    <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      effect <span class="op">=</span> <span class="va">input</span><span class="op">[[</span><span class="st">"effect"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      contaminate_pop_pr_input <span class="op">=</span> <span class="va">contaminate_pop_pr_input</span>,</span>
<span>      contaminate_pop_pr_sd <span class="op">=</span> <span class="va">contaminate_pop_pr_sd</span>,</span>
<span>      spillover_interval <span class="op">=</span> <span class="va">input</span><span class="op">[[</span><span class="st">"spillover_interval"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      nominalpower <span class="op">=</span> <span class="va">examplePower</span><span class="op">$</span><span class="va">geom_full</span><span class="op">$</span><span class="va">power</span>,</span>
<span>      Pvalue_t <span class="op">=</span> <span class="va">Tanalysis</span><span class="op">$</span><span class="va">pt_ests</span><span class="op">$</span><span class="va">p.value</span>,</span>
<span>      effect_size_t <span class="op">=</span> <span class="va">Tanalysis</span><span class="op">$</span><span class="va">pt_ests</span><span class="op">$</span><span class="va">effect_size</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The results are collected in a data frame and post-processed to
classify the outcomes according to whether they represent either Type I
errors or Type II errors</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">input</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>,  FUN <span class="op">=</span> <span class="va">CRTscenario7</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">results_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">significant_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Pvalue_t</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">typeIerror</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">significant_t</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">results</span><span class="op">$</span><span class="va">effect</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">effect</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span> , <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">typeIIerror</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">significant_t</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">effect</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">bias_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">significant_t</span>,<span class="va">effect_size_t</span> <span class="op">-</span> <span class="va">effect</span>,<span class="op">-</span> <span class="va">effect</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="analysis-by-simulated-true-efficacy">Analysis by simulated true efficacy<a class="anchor" aria-label="anchor" href="#analysis-by-simulated-true-efficacy"></a>
</h2>
<p>The results are grouped by ranges of efficacy, for each of which the
ratio of the number of simulations giving statistically significant
results to the expected number can be calculated.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">effect_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">effect</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">by_effect</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">effect</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">effect_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"effect"</span>,<span class="st">"significant_t"</span>, <span class="st">"nominalpower"</span>, <span class="st">"bias_t"</span>, <span class="st">"typeIIerror"</span><span class="op">)</span>,</span>
<span>               <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">by_effect</span><span class="op">$</span><span class="va">power_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">by_effect</span>, <span class="va">significant_t</span><span class="op">/</span><span class="va">nominalpower</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">by_effect</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">effect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">power_ratio</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#b2df8a"</span>,se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">typeIIerror</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#D55E00"</span>,se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">bias_t</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#0072A7"</span>,se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Simulated efficacy (%)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Performance of t-test'</span><span class="op">)</span></span></code></pre></div>
<p>Despite the spillover, the t-test performs similarly to expectations
across the range of efficacies investigated (Figure 7.1)</p>
<p>
<img src="example7d.r-1.png" alt=""><br><em>Fig 7.1 Performance of
t-test by efficacy purple line: ratio of power:nominal power; green
line: type II error rate; blue line : bias. </em>
</p>
</div>
<div class="section level2">
<h2 id="analysis-by-simulated-spillover-interval">Analysis by simulated spillover interval<a class="anchor" aria-label="anchor" href="#analysis-by-simulated-spillover-interval"></a>
</h2>
<p>An analogous analysis, to that of performance relative to efficacy,
can be carried out to explore the effect of the simulated spillover
interval.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">spillover_interval</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">contaminate_pop_pr_input</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#b2df8a"</span>,se <span class="op">=</span> <span class="cn">FALSE</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">contaminate_pop_pr_sd</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#0072A7"</span>,se <span class="op">=</span> <span class="cn">FALSE</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Simulated spillover interval (km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Proportion of the locations'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">theta_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">spillover_interval</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">by_theta</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">effect</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">theta_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spillover_interval"</span>,<span class="st">"significant_t"</span>, <span class="st">"nominalpower"</span>, <span class="st">"bias_t"</span>, <span class="st">"typeIIerror"</span><span class="op">)</span>,</span>
<span>               <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">by_theta</span><span class="op">$</span><span class="va">power_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">by_theta</span>, <span class="va">significant_t</span><span class="op">/</span><span class="va">nominalpower</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">by_theta</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">spillover_interval</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">power_ratio</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#b2df8a"</span>,se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">typeIIerror</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#D55E00"</span>,se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">bias_t</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#0072A7"</span>,se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Simulated spillover interval (km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Performance of t-test'</span><span class="op">)</span></span></code></pre></div>
<p>The relationships between the simulated spillover interval and the
corresponding proportion of the locations in the trial (Figure 7.2).</p>
<p>
<img src="example7e.r-1.png" alt=""><br><em>Fig 7.2 Proportion of
locations in simulated spillover interval green line: zone defined by
<code>gamma_inp</code>; blue line : zone defined by <code>sd</code>.
</em>
</p>
<p>The spillover results in a loss of power, and increased negative bias
in efficacy estimate, but these effects are rather small (Figure
7.3).</p>
<p>The potential for using the <code><a href="../reference/CRTanalysis.html">CRTanalysis()</a></code> function to
model the spillover and hence correct the naive efficacy estimate (from
a t-test) can also be explored (see <a href="Usecase5.html">Use Case
5</a> and <a href="https://malariajournal.biomedcentral.com/articles/10.1186/s12936-021-03924-7" class="external-link">Multerer
<em>et al.</em> (2021b)</a>.</p>
<p>
<img src="example7e.r-2.png" alt=""><br><em>Fig 7.3 Performance of
t-test by spillover interval purple line: ratio of power:nominal power;
green line: type II error rate; blue line: bias. </em>
</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
