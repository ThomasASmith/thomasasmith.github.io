<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use Case 10: Power sample size and bias calculations using a diffusion model for spillover • CRTspat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Case 10: Power sample size and bias calculations using a diffusion model for spillover">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Usecase1.html">Use Case 01: Algorithmic specification of clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase10.html">Use Case 10: Power sample size and bias calculations using a diffusion model for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase2.html">Use Case 02: Simulation of trials with geographical spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase3.html">Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase4.html">Use Case 04: Estimation of optimal cluster size for a trial with pre-determined buffer width</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase5.html">Use Case 05: Analysis of trials (including methods for analysing spillover)</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase6.html">Use Case 06: Thematic mapping of the geography of a CRT</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase7.html">Use Case 07: Power and sample size calculations allowing for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase8.html">Use Case 08: Eggs - to fry or scramble?</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase9.html">Use Case 09: Preparation of datasets for `CRTspat`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use Case 10: Power sample size and bias calculations using a diffusion model for spillover</h1>
            
      

      <div class="d-none name"><code>Usecase10.Rmd</code></div>
    </div>

    
    
<p>The standard formulae for power and sample size calculations for
vector-control CRTs can be extended to allow for spillover by
incorporating a diffusion model for mosquito movement (<a href="https://doi.org/10.21203/rs.3.rs-5423058/v1" class="external-link">Smith et
al(2025)</a>). The calculations required for this are implemented in
<code>CRTspat</code> from v1.3.2.</p>
<p>This vignette provides example calculations for a two-armed trial
where the outcome is the number of events per location (for other
outcome types see the help information for <code><a href="../reference/CRTpower.html">CRTpower()</a></code>).</p>
<p>These calculations entail specifying the usual parameters needed for
power calculations for a CRT, namely:</p>
<ul>
<li>The significance level <code>alpha</code> (usually 0.05)</li>
<li>The <code>desiredPower</code> which is usually 0.8 or 0.9.</li>
<li>‘effect’: the efficacy that the trial should be powered to
detect</li>
<li>The anticipated event rate in the absence of intervention
<code>yC</code> (events per location)</li>
<li>The anticipated between-cluster coefficient of variation,
<code>cv_percent</code>. For malaria trials, a listing of measured
values of this is provided by <a href="https://doi.org/10.1038/s41467-025-61502-w" class="external-link">Biggs et al(2025)</a>.
Alternatively the intra-cluster coefficient (<code>ICC</code>) may be
provided for some kinds of outcomes.</li>
<li>The size of clusters, in terms of the numbers of locations
(<code>h</code>) per cluster.</li>
</ul>
<p>The extension to allow for spillover needs information about the
anticipated spatial pattern of the data, most conveniently in the form
of geolocations of points where data will be collected. It is not
necessary to have locations for the entire study area. Calculations may
be much faster if they are carried out using geolocations from a
sub-area, and are valid if this is representative of the whole.</p>
<p>To carry out the calculations in <code>CRTspat</code> the
geolocations should be in Euclidean (x,y) coordinates with units in km,
roughly centred around (0,0). These are converted to a
<code>CRTsp</code> object. If the original coordinates are in lat long
format, the <code><a href="../reference/latlong_as_xy.html">CRTspat::latlong_as_xy()</a></code> function can convert
to the required format.</p>
<p>To invoke the diffusion model for spillover in
<code><a href="../reference/CRTpower.html">CRTspat::CRTpower()</a></code>:</p>
<ul>
<li>
<code>outcome_type = "d"</code> must be specified.</li>
<li>
<code>spillover_interval</code> defined as the distance encompassing
95% of mosquito movement during the interval between potentially being
faced with the intervention and measurement. Since movement is
approximated with a bivariate normal kernel, the
<code>spillover_interval</code> is approximately 4.9 times the mean
absolute displacement of mosquitoes during one oviposition cycle (<a href="https://doi.org/10.21203/rs.3.rs-5423058/v1" class="external-link">Smith et
al(2025)</a>).</li>
<li>If a buffer zone is defined, with the intention that the main
outcome data are collected only from the core area, then the width of
the <code>buffer</code> is specified in km.</li>
</ul>
<p>The following illustrates the calculations for an example dataset
(with 25 locations allocated to each cluster):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CRTspat</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">"exampleCRT.txt"</span><span class="op">)</span><span class="op">$</span><span class="va">trial</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="st">'y'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">CRT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">locations</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">25</span>, algorithm<span class="op">=</span><span class="st">"NN"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>baselineDenominator<span class="op">=</span><span class="st">"base_denom"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="../reference/specify_buffer.html">specify_buffer</a></span><span class="op">(</span>buffer_width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">power</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTpower.html">CRTpower</a></span><span class="op">(</span><span class="va">CRT</span>, desiredPower <span class="op">=</span> <span class="fl">0.8</span>, effect <span class="op">=</span> <span class="fl">0.3</span>, yC <span class="op">=</span> <span class="fl">0.5</span>, outcome_type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>            cv_percent <span class="op">=</span> <span class="fl">20</span>, spillover_interval <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##                Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x        -3.20    -1.39    -0.30    -0.07     1.25     5.16   </span></span>
<span><span class="co">##       y        -5.07    -2.84     0.19     0.05     2.49     6.16   </span></span>
<span><span class="co">## nearestDiscord -1.37    -0.30     0.01    -0.03     0.26     1.30   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  27.6 sq.km</span></span>
<span><span class="co">## Total area (convex hull) :  48.2 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          Full          Core</span></span>
<span><span class="co">## Coordinate system                      (x, y)            </span></span>
<span><span class="co">##                          </span></span>
<span><span class="co">## Locations:                                                      1181          264</span></span>
<span><span class="co">## Available clusters (across both arms)                           48          26</span></span>
<span><span class="co">##   Per cluster mean number of points                             24.6          10.2</span></span>
<span><span class="co">##   Per cluster s.d. number of points                             2.7          7.6</span></span>
<span><span class="co">## Cluster randomization:                      Independently randomized            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Specification of Requirements</span></span>
<span><span class="co">## -----------------------------          -            </span></span>
<span><span class="co">## Significance level (2-sided):              0.05            </span></span>
<span><span class="co">## Type of Outcome                             count            </span></span>
<span><span class="co">## Expected outcome in control arm:            0.5            </span></span>
<span><span class="co">## Mean rate multiplier:                       1            </span></span>
<span><span class="co">## Required effect size:                       0.3            </span></span>
<span><span class="co">## Coefficient of variation (%):               20            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Power calculations</span></span>
<span><span class="co">## ------------------                              Full          Core</span></span>
<span><span class="co">## Design effect:                                   1.5          1.2</span></span>
<span><span class="co">## Spillover affecting 90.3% of data,</span></span>
<span><span class="co">##   normal model gives bias estimate:          -0.122          -0.077</span></span>
<span><span class="co">## Nominal power (%)                                43.3          37.2</span></span>
<span><span class="co">## Total clusters required (power of 80%):          116          138</span></span>
<span><span class="co">## Sufficient clusters for required power?          No          No</span></span></code></pre>
<p>The output gives power calculations based on the geolocations
provided, and also indicates how large a trial needs to be if it is to
have the required power, even if this is larger than the area
analysed.</p>
<p>A key issue in efficient CRT design is to optimise the size of the
clusters. It is also important to know whether there are advantages in
specifying buffer zones, and if so, how large these should be. These
issues can be addressed by simulating an array of trials with different
sizes of clusters and of buffers. Since the spillover interval is likely
to be very uncertain, it is also relevant to examine the sensitivity of
the required size of trial to the spillover interval.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>yC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                  effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span>,</span>
<span>                  h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">80</span>, <span class="fl">100</span>, <span class="fl">120</span>, <span class="fl">160</span><span class="op">)</span>,</span>
<span>                  cv_percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>                  buffer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span><span class="op">)</span>,</span>
<span>                  spillover_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span><span class="op">)</span>,</span>
<span>                  replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#df$total_pop_required &lt;- df$core_pop_required &lt;- NA</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">'/'</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="st">'\r'</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span></span>
<span>  <span class="va">buffered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>trial <span class="op">=</span> <span class="va">CRT</span>, h<span class="op">=</span><span class="va">df</span><span class="op">$</span><span class="va">h</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, algorithm<span class="op">=</span><span class="st">"NN"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>baselineDenominator<span class="op">=</span><span class="st">"base_denom"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="../reference/specify_buffer.html">specify_buffer</a></span><span class="op">(</span>buffer_width<span class="op">=</span><span class="va">df</span><span class="op">$</span><span class="va">buffer</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="../reference/CRTpower.html">CRTpower</a></span><span class="op">(</span></span>
<span>    trial <span class="op">=</span> <span class="va">buffered</span>,</span>
<span>    desiredPower <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    effect <span class="op">=</span> <span class="va">effect</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    yC <span class="op">=</span> <span class="va">yC</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    outcome_type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>    N <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    cv_percent <span class="op">=</span> <span class="va">cv_percent</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    spillover_interval <span class="op">=</span> <span class="va">spillover_interval</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    distance_distribution <span class="op">=</span> <span class="st">"normal"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">df</span><span class="op">$</span><span class="va">percent_incore</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">power</span><span class="op">$</span><span class="va">geom_core</span><span class="op">$</span><span class="va">locations</span><span class="op">/</span><span class="va">power</span><span class="op">$</span><span class="va">geom_full</span><span class="op">$</span><span class="va">locations</span> <span class="op">*</span> <span class="fl">100</span></span>
<span> <span class="va">df</span><span class="op">$</span><span class="va">total_pop_required</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">power</span><span class="op">$</span><span class="va">geom_full</span><span class="op">$</span><span class="va">mean_h</span> <span class="op">*</span></span>
<span>                                <span class="va">power</span><span class="op">$</span><span class="va">geom_full</span><span class="op">$</span><span class="va">clustersRequired</span></span>
<span> <span class="va">df</span><span class="op">$</span><span class="va">core_pop_required</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">percent_incore</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                                <span class="va">power</span><span class="op">$</span><span class="va">geom_core</span><span class="op">$</span><span class="va">mean_h</span> <span class="op">*</span></span>
<span>                                  <span class="va">power</span><span class="op">$</span><span class="va">geom_core</span><span class="op">$</span><span class="va">clustersRequired</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span> <span class="va">df</span><span class="op">$</span><span class="va">total_clustersRequired</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">power</span><span class="op">$</span><span class="va">geom_full</span><span class="op">$</span><span class="va">clustersRequired</span></span>
<span> <span class="va">df</span><span class="op">$</span><span class="va">core_clustersRequired</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">percent_incore</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                                <span class="va">power</span><span class="op">$</span><span class="va">geom_core</span><span class="op">$</span><span class="va">clustersRequired</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">df</span><span class="op">$</span><span class="va">full_bias</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">power</span><span class="op">$</span><span class="va">geom_full</span><span class="op">$</span><span class="va">delta</span></span>
<span> <span class="va">df</span><span class="op">$</span><span class="va">core_bias</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">percent_incore</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                                <span class="va">power</span><span class="op">$</span><span class="va">geom_core</span><span class="op">$</span><span class="va">delta</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">df_means</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">yC</span>, <span class="va">effect</span>, <span class="va">h</span>, <span class="va">cv_percent</span>, <span class="va">buffer</span>, <span class="va">spillover_interval</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>core_pop_required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">core_pop_required</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            core_clustersRequired <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">core_clustersRequired</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            core_bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">core_bias</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            percent_incore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">percent_incore</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_means</span><span class="op">$</span><span class="va">total_to_enumerate</span> <span class="op">&lt;-</span></span>
<span>        <span class="fl">100</span><span class="op">*</span><span class="va">df_means</span><span class="op">$</span><span class="va">core_pop_required</span><span class="op">/</span><span class="va">df_means</span><span class="op">$</span><span class="va">percent_incore</span></span>
<span><span class="va">df_overallmeans</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">yC</span>, <span class="va">effect</span>, <span class="va">h</span>, <span class="va">cv_percent</span>, <span class="va">spillover_interval</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>total_pop_required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">total_pop_required</span><span class="op">)</span>,</span>
<span>            total_clustersRequired <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">total_clustersRequired</span><span class="op">)</span>,</span>
<span>            full_bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">full_bias</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To plot the results of these calculations, first create plotting
functions</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">cbPalette</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#CC79A7"</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="va">facetplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_means</span>, <span class="va">df_overallmeans</span>, <span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">df_means</span><span class="op">$</span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">df_means</span><span class="op">[[</span><span class="va">y1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">df_overallmeans</span><span class="op">$</span><span class="va">y2</span> <span class="op">&lt;-</span> <span class="va">df_overallmeans</span><span class="op">[[</span><span class="va">y2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span> <span class="va">df_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">h</span>,y <span class="op">=</span> <span class="va">y1</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">buffer</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu">cbPalette</span><span class="op">(</span><span class="op">)</span>,name <span class="op">=</span> <span class="st">'Buffer width (km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Cluster size (locations allocated to each cluster)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_overallmeans</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y2</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">spillover_interval</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>To generate the plots</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Fig10_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span> <span class="va">df_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">h</span>,y <span class="op">=</span> <span class="va">percent_incore</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">buffer</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu">cbPalette</span><span class="op">(</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">'Buffer width (km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Cluster size (locations allocated to each cluster)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Percentage of locations in the cluster core"</span><span class="op">)</span></span></code></pre></div>
<p>The results are presented with the total number of locations
allocated to each cluster on the horizontal axis. This total includes
both core and buffer locations. With the given example geography, the
proportion of locations in the core is highly dependent on the buffer
width(Figure 10.1). With small clusters and wide buffers, almost the
almost the whole study area falls in buffers.</p>
<p>
<img src="example10e.r-1.png" alt=""><br><em>Fig 10.1 Effects of
spillover interval and proportion of locations in core</em>
</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">facetplot</span><span class="op">(</span>df_means <span class="op">=</span> <span class="va">df_means</span>, df_overallmeans <span class="op">=</span> <span class="va">df_overallmeans</span>,</span>
<span>  y1 <span class="op">=</span> <span class="st">"core_pop_required"</span>,</span>
<span>  y2 <span class="op">=</span> <span class="st">"total_pop_required"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Total number of locations required in core"</span>,</span>
<span>                      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e+03</span>, <span class="fl">1e+05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">facetplot</span><span class="op">(</span>df_means <span class="op">=</span> <span class="va">df_means</span>, df_overallmeans <span class="op">=</span> <span class="va">df_overallmeans</span>,</span>
<span>  y1 <span class="op">=</span> <span class="st">"total_to_enumerate"</span>,</span>
<span>  y2 <span class="op">=</span> <span class="st">"total_pop_required"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Total number of locations requiring enumeration"</span>,</span>
<span>                      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e+03</span>, <span class="fl">1e+05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">facetplot</span><span class="op">(</span>df_means <span class="op">=</span> <span class="va">df_means</span>, df_overallmeans <span class="op">=</span> <span class="va">df_overallmeans</span>,</span>
<span>          y1 <span class="op">=</span> <span class="st">"core_clustersRequired"</span>,</span>
<span>          y2 <span class="op">=</span> <span class="st">"total_clustersRequired"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Total number of clusters required"</span>,</span>
<span>                      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">facetplot</span><span class="op">(</span>df_means <span class="op">=</span> <span class="va">df_means</span>, df_overallmeans <span class="op">=</span> <span class="va">df_overallmeans</span>,</span>
<span>          y1 <span class="op">=</span> <span class="st">"core_bias"</span>,</span>
<span>          y2 <span class="op">=</span> <span class="st">"full_bias"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Bias in effect size estimate"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="va">Fig10_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>, <span class="st">'D'</span><span class="op">)</span>, label_size <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Figures 10.2A-D are each divided into 4 panels corresponding to
different values of the spillover interval. The noise in the results
arises because of the random cluster assignments and can be reduced by
averaging over more simulations (or using a larger set of
locations).</p>
<p>Except in the case of the largest spillover interval of 2km, the
required number of locations in the core (Fig 10.2A) increases with the
size of the clusters (corresponding to a strong decrease in the number
of clusters needed (Figure 10.2C), while the number of locations
required in the core decreases with buffer width. These large buffer
zones must however be traded off against the very large total numbers of
locations needing enumerating in CRTs with large buffer zones (Figure
10.2B)</p>
<p>
<img src="example10f.r-1.png" alt=""><br><em>Fig 10.2 Effects of
spillover interval and buffer width on required sample size</em>
</p>
<p>These considerations suggest that there is little advantage in
increasing the core size above a value of about 60 for this set of
parameters. Above this size the expected bias (Figure 10.2D) is modest,
irrespective of the buffer width, unless the spillover interval is very
large or clusters very small. It should be noted that a smaller number
of locations are needed in the core if more data is collected from each
location. This is equivalent to increasing the value of ´yC´ in these
simulations.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
