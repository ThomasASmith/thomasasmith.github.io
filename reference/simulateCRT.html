<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulation of cluster randomized trial with spillover — simulateCRT • CRTspat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation of cluster randomized trial with spillover — simulateCRT"><meta name="description" content="simulateCRT generates simulated data for a cluster randomized trial (CRT) with geographic spillover between arms."><meta property="og:description" content="simulateCRT generates simulated data for a cluster randomized trial (CRT) with geographic spillover between arms."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Usecase1.html">Use Case 01: Algorithmic specification of clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase2.html">Use Case 02: Simulation of trials with geographical spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase3.html">Use Case 03: Estimation of intracluster correlations (ICC) by cluster size</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase4.html">Use Case 04: Estimation of optimal cluster size for a trial with pre-determined buffer width</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase5.html">Use Case 05: Analysis of trials (including methods for analysing spillover)</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase6.html">Use Case 06: Thematic mapping of the geography of a CRT</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase7.html">Use Case 07: Power and sample size calculations allowing for spillover</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase8.html">Use Case 08: Eggs - to fry or scramble?</a></li>
    <li><a class="dropdown-item" href="../articles/Usecase9.html">Use Case 09: Preparation of datasets for `CRTspat`</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation of cluster randomized trial with spillover</h1>

      <div class="d-none name"><code>simulateCRT.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>simulateCRT</code> generates simulated data for a cluster randomized trial (CRT) with geographic spillover between arms.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simulateCRT</span><span class="op">(</span></span>
<span>  trial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  effect <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  outcome0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  generateBaseline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  matchedPair <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"proportion"</span>,</span>
<span>  baselineNumerator <span class="op">=</span> <span class="st">"base_num"</span>,</span>
<span>  baselineDenominator <span class="op">=</span> <span class="st">"base_denom"</span>,</span>
<span>  denominator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ICC_inp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  kernels <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  sigma_m <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spillover_interval <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.005</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-trial">trial<a class="anchor" aria-label="anchor" href="#arg-trial"></a></dt>
<dd><p>an object of class <code>"CRTsp"</code> or a data frame containing locations in (x,y) coordinates, cluster
assignments (factor <code>cluster</code>), and arm assignments (factor <code>arm</code>). Each location may also be
assigned a <code>propensity</code> (see details).</p></dd>


<dt id="arg-effect">effect<a class="anchor" aria-label="anchor" href="#arg-effect"></a></dt>
<dd><p>numeric. The simulated effect size (defaults to 0)</p></dd>


<dt id="arg-outcome-">outcome0<a class="anchor" aria-label="anchor" href="#arg-outcome-"></a></dt>
<dd><p>numeric. The anticipated value of the outcome in the absence of intervention</p></dd>


<dt id="arg-generatebaseline">generateBaseline<a class="anchor" aria-label="anchor" href="#arg-generatebaseline"></a></dt>
<dd><p>logical. If <code>TRUE</code> then baseline data and the <code>propensity</code> will be simulated</p></dd>


<dt id="arg-matchedpair">matchedPair<a class="anchor" aria-label="anchor" href="#arg-matchedpair"></a></dt>
<dd><p>logical. If <code>TRUE</code> then the function tries to carry out randomization
using pair-matching on the baseline data (see details)</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>measurement scale of the outcome. Options are: 'proportion' (the default); 'count'; 'continuous'.</p></dd>


<dt id="arg-baselinenumerator">baselineNumerator<a class="anchor" aria-label="anchor" href="#arg-baselinenumerator"></a></dt>
<dd><p>optional name of numerator variable for pre-existing baseline data</p></dd>


<dt id="arg-baselinedenominator">baselineDenominator<a class="anchor" aria-label="anchor" href="#arg-baselinedenominator"></a></dt>
<dd><p>optional name of denominator variable for pre-existing baseline data</p></dd>


<dt id="arg-denominator">denominator<a class="anchor" aria-label="anchor" href="#arg-denominator"></a></dt>
<dd><p>optional name of denominator variable for the outcome</p></dd>


<dt id="arg-icc-inp">ICC_inp<a class="anchor" aria-label="anchor" href="#arg-icc-inp"></a></dt>
<dd><p>numeric. Target intra cluster correlation, provided as input when baseline data are to be simulated</p></dd>


<dt id="arg-kernels">kernels<a class="anchor" aria-label="anchor" href="#arg-kernels"></a></dt>
<dd><p>number of kernels used to generate a de novo <code>propensity</code></p></dd>


<dt id="arg-sigma-m">sigma_m<a class="anchor" aria-label="anchor" href="#arg-sigma-m"></a></dt>
<dd><p>numeric. standard deviation of the normal kernel measuring spatial smoothing leading to spillover</p></dd>


<dt id="arg-spillover-interval">spillover_interval<a class="anchor" aria-label="anchor" href="#arg-spillover-interval"></a></dt>
<dd><p>numeric. input spillover interval</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>numeric. tolerance of output ICC</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of class <code>"CRTsp"</code> containing the following components:</p><table class="table table"><tr><td><code>geom_full</code></td><td>list:</td><td>summary statistics describing the site
cluster assignments, and randomization</td></tr><tr><td><code>design</code></td><td>list:</td><td>values of input parameters to the design</td></tr><tr><td><code>trial</code></td><td>data frame:</td><td>rows correspond to geolocated points, as follows:</td></tr><tr><td></td><td><code>x</code></td><td>numeric vector:  x-coordinates of locations</td></tr><tr><td></td><td><code>y</code></td><td>numeric vector:  y-coordinates of locations</td></tr><tr><td></td><td><code>cluster</code></td><td>factor:  assignments to cluster of each location</td></tr><tr><td></td><td><code>arm</code></td><td>factor:  assignments to <code>control</code> or <code>intervention</code> for each location</td></tr><tr><td></td><td><code>nearestDiscord</code></td><td>numeric vector:  signed Euclidean distance to nearest discordant location (km)</td></tr><tr><td></td><td><code>propensity</code></td><td>numeric vector:  propensity for each location</td></tr><tr><td></td><td><code>base_denom</code></td><td>numeric vector:  denominator for baseline</td></tr><tr><td></td><td><code>base_num</code></td><td>numeric vector:  numerator for baseline</td></tr><tr><td></td><td><code>denom</code></td><td>numeric vector:  denominator for the outcome</td></tr><tr><td></td><td><code>num</code></td><td>numeric vector:  numerator for the outcome</td></tr><tr><td></td><td><code>...</code></td><td>other objects included in the input <code>"CRTsp"</code> object
or <code>data.frame</code></td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Synthetic data are generated by sampling around the values of
variable <code>propensity</code>, which is a numerical vector
(taking positive values) of length equal to the number of locations.
There are three ways in which <code>propensity</code> can arise:</p><ol><li><p><code>propensity</code> can be provided as part of the input <code>trial</code> object.</p></li>
<li><p>Baseline numerators and denominators (values of <code>baselineNumerator</code>
and <code>baselineDenominator</code> may be provided.
<code>propensity</code> is then generated as the numerator:denominator ratio
for each location in the input object</p></li>
<li><p>Otherwise <code>propensity</code> is generated using a 2D Normal
kernel density. The <a href="https://rdrr.io/cran/OOR/man/StoSOO.html" class="external-link"><code><a href="https://rdrr.io/pkg/OOR/man/StoSOO.html" class="external-link">OOR::StoSOO</a></code></a>
is used to achieve an intra-cluster correlation coefficient (ICC) that approximates
the value of <code>'ICC_inp'</code> by searching for an appropriate value of the kernel bandwidth.</p></li>
</ol><p><code>num[i]</code>, the synthetic outcome for location <code>i</code>
is simulated with expectation: <br>
$$E(num[i]) = outcome0[i] * propensity[i] * denom[i] * (1 - effect*I[i])/mean(outcome0[] * propensity[])$$ <br>
The sampling distribution of <code>num[i]</code> depends on the value of <code>scale</code> as follows: <br></p><ul><li><p><code>scale</code>=’continuous’: Values of <code>num</code> are sampled from a
Normal distributions with means <code>E(num[i])</code>
and variance determined by the fitting to <code>ICC_inp</code>.<br></p></li>
<li><p><code>scale</code>=’count’: Simulated events are allocated to locations via multivariate hypergeometric distributions
parameterised with <code>E(num[i])</code>.<br></p></li>
<li><p><code>scale</code>=’proportion’: Simulated events are allocated to locations via multinomial distributions
parameterised with <code>E(num[i])</code>.<br></p></li>
</ul><p><code>denominator</code> may specify a vector of numeric (non-zero) values
in the input <code>"CRTsp"</code> or <code>data.frame</code> which is returned
as variable <code>denom</code>. It acts as a scale-factor for continuous outcomes, rate-multiplier
for counts, or denominator for proportions. For discrete data all values of <code>denom</code>
must be &gt; 0.5 and are rounded to the nearest integer in calculations of <code>num</code>.<br><br>
By default, <code>denom</code> is generated as a vector of ones, leading to simulation of
dichotomous outcomes if <code>scale</code>=’proportion’.<br></p>
<p>If baseline numerators and denominators are provided then the output vectors
<code>base_denom</code> and  <code>base_num</code> are set to the input values. If baseline numerators and denominators
are not provided then the synthetic baseline data are generated by sampling around <code>propensity</code> in the same
way as the outcome data, but with the effect size set to zero.</p>
<p>If <code>matchedPair</code> is <code>TRUE</code> then pair-matching on the baseline data will be used in randomization providing
there are an even number of clusters. If there are an odd number of clusters then matched pairs are not generated and
an unmatched randomization is output.</p>
<p>Either <code>sigma_m</code> or <code>spillover_interval</code> must be provided. If both are provided then
the value of <code>sigma_m</code> is overwritten
by the standard deviation implicit in the value of <code>spillover_interval</code>.
Spillover is simulated as arising from a diffusion-like process.</p>
<p>For further details see <a href="https://edoc.unibas.ch/85228/" class="external-link">Multerer (2021)</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="op">{</span><span class="va">smalltrial</span> <span class="op">&lt;-</span> <span class="fu"><a href="readdata.html">readdata</a></span><span class="op">(</span><span class="st">'smalltrial.csv'</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">simulation</span> <span class="op">&lt;-</span> <span class="fu">simulateCRT</span><span class="op">(</span><span class="va">smalltrial</span>,</span></span>
<span class="r-in"><span>  effect <span class="op">=</span> <span class="fl">0.25</span>,</span></span>
<span class="r-in"><span>  ICC_inp <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>  outcome0 <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  matchedPair <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  scale <span class="op">=</span> <span class="st">'proportion'</span>,</span></span>
<span class="r-in"><span>  sigma_m <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  tol <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =====================    SIMULATION OF CLUSTER RANDOMISED TRIAL    =================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *** computed distance to nearest measurements in discordant arm ***</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating the smoothing required to achieve the target ICC of 0.05</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tol: 0.05 loss = 0.0014853339089726 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> bandwidth: 0.0117436284570214  ICC = 0.0885400299555228 loss = 0.0014853339089726 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===============================CLUSTER RANDOMISED TRIAL ===========================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of coordinates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       x        -0.70    -0.23    -0.00     0.01     0.30     0.58   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       y        -0.77    -0.22    -0.00     0.05     0.24     1.55   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nearestDiscord -0.34    -0.21    -0.06    -0.00     0.13     1.06   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total area (within  0.2 km of a location) :  2.06 sq.km</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total area (convex hull) :  1.32 sq.km</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Locations and Clusters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------                                          -                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coordinate system                      (x, y)                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Locations:                                                      208                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Available clusters (across both arms)                           18                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Per cluster mean number of points                             11.6                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Per cluster s.d. number of points                             4.9                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cluster randomization:                      Independently randomized                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> No power calculations to report          -                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Other variables in dataset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> --------------------------          denom  propensity  num  base_denom  base_num                        </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

